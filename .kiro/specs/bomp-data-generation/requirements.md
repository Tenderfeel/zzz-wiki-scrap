# 要件定義書

## 概要

この機能は、Zenless Zone Zero の全ボンプエンティティについて HoyoLab API エンドポイントから詳細情報を抽出する包括的なボンプデータ生成システムを作成します。キャラクターデータと同様に、システムは基本情報、ステータス属性、その他の関連データを処理し、既存プロジェクトの型定義とアーキテクチャパターンに準拠した構造化 TypeScript オブジェクトを生成します。

## 要件

### 要件 1

**ユーザーストーリー:** 開発者として、HoyoLab API エンドポイントから構造化されたボンプデータ配列を生成したい。そうすることで、アプリケーションで一貫性があり型安全なボンプ情報を利用できるようになる。

#### 受入基準

1. WHEN システムがボンプ API エンドポイントを処理する時 THEN Scraping.md にリストされた全 32 のボンプエントリからデータを抽出する SHALL
2. WHEN API リクエストを行う時 THEN ja-jp 言語パラメータを主要とし、en-us をフォールバックとして使用する SHALL
3. WHEN API レスポンスを処理する時 THEN data.page 構造から name、stats を含む基本情報を抽出する SHALL
4. WHEN 出力を生成する時 THEN エクスポートされたボンプ配列を含む TypeScript ファイルを `data/bomps.ts` に作成する SHALL
5. WHEN API 失敗を処理する時 THEN グレースフル劣化を実装し、他のエントリの処理を継続する SHALL

### 要件 2

**ユーザーストーリー:** 開発者として、ボンプデータに包括的な属性と統計情報を含めたい。そうすることで、ゲームメカニクスとキャラクター分析にデータを使用できるようになる。

#### 受入基準

1. WHEN ボンプ属性を抽出する時 THEN data.page.modules からアセンションコンポーネントデータを処理する SHALL
2. WHEN 属性データを解析する時 THEN 全 7 レベル（1, 10, 20, 30, 40, 50, 60）の HP、攻撃力、防御力配列を抽出する SHALL
3. WHEN 単一値属性を処理する時 THEN レベル 1 データから impact、critRate、critDmg、anomalyMastery、anomalyProficiency、penRatio、energy を抽出する SHALL
4. WHEN "-" 値に遭遇する時 THEN 適切なデフォルト値（ほとんどの場合は 0）に変換する SHALL
5. WHEN パーセンテージ値を処理する時 THEN "%" 記号を除去し、数値に変換する SHALL

### 要件 3

**ユーザーストーリー:** 開発者として、ボンプデータが確立されたプロジェクトパターンと型安全性に従うようにしたい。そうすることで、既存のキャラクターと派閥システムとシームレスに統合できるようになる。

#### 受入基準

1. WHEN ボンプ型を定義する時 THEN 既存の Character と Faction 型を拡張または補完する TypeScript インターフェースを作成する SHALL
2. WHEN 特技データを処理する時 THEN 確立されたマッピングを使用して日本語特技値を英語列挙値にマップする SHALL
3. WHEN 属性データを処理する時 THEN 日本語属性値を英語列挙値（ice、fire、electric、physical、ether）にマップする SHALL
4. WHEN 攻撃タイプを処理する時 THEN 日本語攻撃タイプ値を英語列挙値（slash、pierce、strike）にマップする SHALL
5. WHEN 派閥参照を生成する時 THEN 既存の派閥データ構造と一貫性のある派閥 ID と名前を抽出する SHALL

### 要件 4

**ユーザーストーリー:** 開発者として、ボンプデータ生成を信頼性があり保守可能にしたい。そうすることで、新しいボンプが追加されたり API 構造が変更されたりした時に簡単に更新できるようになる。

#### 受入基準

1. WHEN 生成システムを実装する時 THEN 確立されたアーキテクチャレイヤー（clients → parsers → mappers → processors → generators）に従う SHALL
2. WHEN データを処理する時 THEN 各処理ステップで包括的なエラーハンドリングとログ記録を実装する SHALL
3. WHEN API レート制限に遭遇する時 THEN リクエスト間に適切な遅延を実装する SHALL
4. WHEN 出力ファイルを生成する時 THEN 書き込み前に TypeScript 型定義に対してすべてのデータを検証する SHALL
5. WHEN システムが新しいまたは未知のデータ構造に遭遇する時 THEN 警告をログに記録するが、適切なデフォルト値で処理を継続する SHALL

### 要件 5

**ユーザーストーリー:** 開発者として、ボンプデータの多言語サポートを実現したい。そうすることで、アプリケーションが異なるロケールのユーザーにサービスを提供できるようになる。

#### 受入基準

1. WHEN API リクエストを行う時 THEN 各ボンプの日本語（ja-jp）と英語（en-us）両方のバージョンを取得する SHALL
2. WHEN 名前を処理する時 THEN ja と en プロパティの両方を持つ多言語名オブジェクトを作成する SHALL
3. WHEN 英語データが利用できない時 THEN 英語フィールドのフォールバックとして日本語データを使用する SHALL
4. WHEN 両方の言語が失敗する時 THEN エラーをログに記録し、フォールバック名としてボンプ ID を使用する SHALL
5. WHEN 最終データ構造を生成する時 THEN すべての名前フィールドは ja と en プロパティを持つ Lang 型定義に準拠する SHALL
