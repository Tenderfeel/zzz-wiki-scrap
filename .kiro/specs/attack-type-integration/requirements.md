# 要件ドキュメント

## 概要

現在のキャラクターデータ生成システムでは、攻撃タイプ（AttackType）の情報を個別の API 呼び出しから取得していますが、一部のキャラクターで wiki の json データから攻撃タイプを取得できない場合があります。`json/data/list.json`ファイルには全キャラクターの攻撃タイプ情報が含まれているため、この機能は、wiki データから攻撃タイプを取得できなかった場合のフォールバック機能として、`json/data/list.json`から攻撃タイプ情報を取得する仕組みを実装することを目的としています。

## 要件

### 要件 1

**ユーザーストーリー:** 開発者として、wiki データから攻撃タイプを取得できなかった場合にフォールバック機能を利用したいので、`json/data/list.json` ファイルから攻撃タイプデータを読み込む機能が必要です。

#### 受け入れ基準

1. WHEN wiki の json データから攻撃タイプが取得できない場合 THEN システムは `json/data/list.json` から攻撃タイプ情報を読み込む SHALL
2. WHEN `json/data/list.json` 内の `agent_attack_type` フィールドが存在する THEN システムは該当する攻撃タイプ値を抽出する SHALL
3. WHEN 攻撃タイプが複数存在する（例：["Slash", "Pierce"]） THEN システムは最初の値を主要攻撃タイプとして使用する SHALL
4. WHEN 攻撃タイプの英語値（"Slash", "Pierce", "Strike"）が取得される THEN システムは対応する日本語の enum 値（"slash", "pierce", "strike"）にマッピングする SHALL

### 要件 2

**ユーザーストーリー:** 開発者として、攻撃タイプのマッピングが正確であることを確認したいので、英語表記から適切な enum 値への変換機能が必要です。

#### 受け入れ基準

1. WHEN 攻撃タイプが "Slash" の場合 THEN システムは "slash" enum 値を返す SHALL
2. WHEN 攻撃タイプが "Pierce" の場合 THEN システムは "pierce" enum 値を返す SHALL
3. WHEN 攻撃タイプが "Strike" の場合 THEN システムは "strike" enum 値を返す SHALL
4. WHEN 未知の攻撃タイプが検出された場合 THEN システムはエラーログを出力し、デフォルト値として "strike" を使用する SHALL

### 要件 3

**ユーザーストーリー:** 開発者として、既存のキャラクターデータ生成プロセスとの互換性を維持したいので、フォールバック機能が既存のワークフローにシームレスに統合される必要があります。

#### 受け入れ基準

1. WHEN wiki データから攻撃タイプが正常に取得できる場合 THEN システムは従来通り wiki データを優先して使用する SHALL
2. WHEN `json/data/list.json` ファイルが存在しない場合 THEN システムは適切なエラーハンドリングを行い、デフォルト値を使用する SHALL
3. WHEN キャラクターに攻撃タイプ情報が両方のソースに存在しない場合 THEN システムは適切なエラーログを出力し、デフォルト値として "strike" を使用する SHALL
4. WHEN 生成されたキャラクターデータ THEN 攻撃タイプフィールドは既存の型定義（AttackType）に準拠する SHALL

### 要件 4

**ユーザーストーリー:** 開発者として、フォールバック機能の動作を監視したいので、攻撃タイプの取得方法とその結果をログで確認できる必要があります。

#### 受け入れ基準

1. WHEN 攻撃タイプ情報が wiki データから取得される THEN ログに "wiki データから攻撃タイプを取得" と記録される SHALL
2. WHEN 攻撃タイプ情報が `json/data/list.json` から取得される THEN ログに "list.json から攻撃タイプをフォールバック取得" と記録される SHALL
3. WHEN 複数キャラクターの処理が実行される THEN `json/data/list.json` の読み込みは一度だけ行われ、メモリ上にキャッシュされる SHALL
4. WHEN フォールバック機能が使用される THEN 該当キャラクターの ID と取得された攻撃タイプがログに記録される SHALL
