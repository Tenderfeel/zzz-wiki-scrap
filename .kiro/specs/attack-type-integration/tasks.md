# 実装計画

- [x] 1. 型定義とインターフェースの作成

  - `json/data/list.json` のデータ構造に対応する型定義を追加
  - `ListJsonData`, `CharacterListItem`, `AttackTypeValueType` インターフェースを定義
  - 既存の型定義ファイルに統合
  - _要件: 1.2, 2.1, 2.2, 2.3_

- [x] 2. AttackTypeFallbackService クラスの実装

  - [x] 2.1 基本クラス構造とプロパティの定義

    - クラスの基本構造を作成
    - `listData`, `isInitialized` プロパティを定義
    - 必要な import 文を追加
    - _要件: 1.1, 1.2_

  - [x] 2.2 list.json 読み込み機能の実装

    - `initialize()` メソッドを実装
    - ファイル存在確認とエラーハンドリング
    - JSON 解析と型安全性の確保
    - 一度だけ実行される仕組みの実装
    - _要件: 1.1, 3.2, 4.3_

  - [x] 2.3 攻撃タイプ検索機能の実装

    - `getAttackTypeByPageId()` メソッドを実装
    - pageId による キャラクター検索ロジック
    - 複数攻撃タイプがある場合の最初の値選択
    - _要件: 1.2, 1.3_

  - [x] 2.4 英語攻撃タイプマッピング機能の実装

    - `mapEnglishAttackType()` プライベートメソッドを実装
    - "Slash", "Pierce", "Strike" から enum 値へのマッピング
    - 未知の値に対するエラーハンドリング
    - _要件: 2.1, 2.2, 2.3, 2.4_

  - [x] 2.5 AttackTypeFallbackService の単体テスト作成
    - 正常ケースのテスト（ファイル読み込み、攻撃タイプ取得）
    - エラーケースのテスト（ファイル不存在、JSON 解析エラー）
    - マッピング機能のテスト
    - _要件: 1.1, 1.2, 2.1, 2.2, 2.3, 2.4_

- [x] 3. DataMapper クラスの拡張

  - [x] 3.1 AttackTypeFallbackService の統合

    - `DataMapper` クラスに `AttackTypeFallbackService` のインスタンスを追加
    - コンストラクタでサービスの初期化
    - 依存性注入の仕組みを実装
    - _要件: 3.1_

  - [x] 3.2 mapAttackType メソッドの拡張

    - 既存の `mapAttackType` メソッドのシグネチャを拡張（pageId パラメータ追加）
    - フォールバック機能付きのマッピングロジックを実装
    - 既存の日本語マッピングを優先する仕組み
    - _要件: 1.1, 3.1_

  - [x] 3.3 フォールバック機能の実装

    - `mapAttackTypeWithFallback()` プライベートメソッドを実装
    - wiki データ取得失敗時のフォールバック処理
    - デフォルト値 "strike" の設定
    - _要件: 1.1, 3.3, 2.4_

  - [x] 3.4 拡張された DataMapper の単体テスト作成
    - フォールバック機能付きマッピングのテスト
    - 既存機能の互換性テスト
    - エラーハンドリングのテスト
    - _要件: 3.1, 3.3, 2.4_

- [x] 4. CharacterGenerator クラスの修正

  - [x] 4.1 pageId パラメータの追加

    - `generateCharacter` メソッドに pageId パラメータを追加
    - `DataMapper.mapAttackType` 呼び出し時に pageId を渡す
    - 既存の呼び出し元との互換性を維持
    - _要件: 3.1, 3.4_

  - [x] 4.2 エラーハンドリングの強化

    - 攻撃タイプ取得失敗時の適切なエラーハンドリング
    - ログ出力の追加（取得方法の記録）
    - 処理継続の仕組み
    - _要件: 3.3, 4.1, 4.2, 4.4_

  - [x] 4.3 CharacterGenerator の単体テスト更新
    - 新しい pageId パラメータを含むテストケース
    - フォールバック機能を使用するテストケース
    - エラーハンドリングのテストケース
    - _要件: 3.1, 3.3, 4.1, 4.2_

- [x] 5. ログ機能の実装

  - [x] 5.1 ログレベルとメッセージの定義

    - INFO, WARN, DEBUG, ERROR レベルのログメッセージを定義
    - フォールバック使用時のログメッセージ
    - エラー時のログメッセージ
    - _要件: 4.1, 4.2, 4.4_

  - [x] 5.2 各コンポーネントへのログ追加
    - `AttackTypeFallbackService` にログ機能を追加
    - `DataMapper` にログ機能を追加
    - `CharacterGenerator` にログ機能を追加
    - _要件: 4.1, 4.2, 4.4_

- [x] 6. 統合テストの実装

  - [x] 6.1 正常フローの統合テスト

    - wiki データから正常取得するケース
    - フォールバック機能が動作するケース
    - 最終的な Character オブジェクト生成の確認
    - _要件: 1.1, 1.2, 1.3, 1.4, 3.1_

  - [x] 6.2 エラーシナリオの統合テスト

    - list.json ファイル不存在時の動作
    - JSON 解析エラー時の動作
    - 未知の攻撃タイプ値の処理
    - システム継続動作の確認
    - _要件: 3.2, 3.3, 2.4_

  - [x] 6.3 パフォーマンステスト
    - 複数キャラクター処理時のメモリ使用量測定
    - list.json の一度だけ読み込みの確認
    - フォールバック機能のレスポンス時間測定
    - _要件: 4.3_

- [x] 7. ドキュメントの更新

  - [x] 7.1 API ドキュメントの更新

    - 拡張された `DataMapper.mapAttackType` メソッドのドキュメント
    - `AttackTypeFallbackService` クラスのドキュメント
    - 新しい型定義のドキュメント
    - _要件: 全般_

  - [x] 7.2 使用例とトラブルシューティングガイド
    - フォールバック機能の使用例
    - エラー時のトラブルシューティング手順
    - ログメッセージの解釈方法
    - _要件: 4.1, 4.2, 4.4_
