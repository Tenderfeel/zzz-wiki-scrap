# 実装計画

- [x] 1. 型定義の拡張とインターフェース更新

  - src/types/index.ts の Bomp インターフェースに rarity: Rarity フィールドを追加
  - BasicBompInfo インターフェースに rarity: string フィールドを追加
  - 型定義の整合性を確認し、コンパイルエラーを修正
  - _要件: 1.1, 3.1, 5.2_

- [x] 2. BompDataMapper のレア度抽出機能実装

  - [x] 2.1 baseInfo からレア度抽出機能を実装

    - extractRarityFromBaseInfo() メソッドを追加して baseInfo コンポーネントからレア度を抽出
    - JSON 解析と list 配列からのレア度キー検索機能を実装
    - エラーハンドリングと適切なログ記録を追加
    - _要件: 2.1, 2.4_

  - [x] 2.2 レア度正規化機能を実装

    - normalizeRarity() メソッドを追加して"A 級"→"A"、"S 級"→"S"の変換を実装
    - 無効なレア度値の検証とエラーハンドリングを追加
    - 正規化処理のログ記録を実装
    - _要件: 2.2_

  - [x] 2.3 既存の extractBasicBompInfo メソッドを拡張
    - レア度抽出を basicInfo 抽出プロセスに統合
    - エラー時のグレースフル劣化処理を実装
    - レア度抽出の成功/失敗統計を記録
    - _要件: 3.1, 2.5_

- [x] 3. BompDataProcessor のレア度処理統合

  - [x] 3.1 レア度データ検証機能を実装

    - validateRarityData() メソッドを追加してレア度値の妥当性を検証
    - ProcessedBompData の検証にレア度チェックを統合
    - レア度検証エラーの適切な処理を実装
    - _要件: 3.4, 4.1_

  - [x] 3.2 processBompData メソッドを拡張

    - レア度抽出をボンプデータ処理パイプラインに統合
    - レア度抽出失敗時のフォールバック処理を実装
    - レア度処理の詳細ログ記録を追加
    - _要件: 3.1, 2.5_

  - [x] 3.3 レア度処理の単体テストを作成
    - レア度抽出機能のテストケースを作成
    - エラーケース処理のテストを実装
    - グレースフル劣化処理のテストを追加
    - _要件: 4.1, 4.3_

- [x] 4. BompGenerator のレア度統合機能実装

  - [x] 4.1 generateBomp メソッドを拡張

    - レア度マッピングをボンプ生成プロセスに統合
    - DataMapper.mapRarity() を使用したレア度変換を実装
    - レア度フィールドを含む完全な Bomp オブジェクト生成
    - _要件: 3.3, 5.1_

  - [x] 4.2 validateBomp メソッドを拡張

    - レア度フィールドの存在確認を追加
    - レア度値の妥当性検証（"A"または"S"）を実装
    - レア度検証エラーの適切な報告を追加
    - _要件: 3.4, 5.4_

  - [x] 4.3 formatBompObject メソッドを拡張
    - TypeScript 出力にレア度フィールドを追加
    - 適切なフォーマットでレア度値を出力
    - 出力ファイルの構造整合性を確保
    - _要件: 5.3_

- [x] 4.4 BompGenerator の単体テストを作成

  - レア度統合機能のテストケースを作成
  - レア度検証ロジックのテストを実装
  - 出力フォーマットの正確性テストを追加
  - _要件: 4.1, 4.2_

- [x] 5. 統合テストと検証

  - [x] 5.1 エンドツーエンドレア度処理テストを実装

    - 実際の API データを使用したレア度抽出テスト
    - 全ボンプデータでのレア度統合テスト
    - 出力ファイルでのレア度表示確認テスト
    - _要件: 4.2_

  - [x] 5.2 後方互換性テストを実行

    - 既存のボンプデータ生成機能の動作確認
    - レア度なしデータの適切な処理テスト
    - 既存テストスイートの継続実行確認
    - _要件: 3.5, 4.5_

  - [x] 5.3 パフォーマンステストを実行
    - レア度処理追加による性能影響測定
    - メモリ使用量の変化確認
    - 処理時間の変化測定
    - _要件: 4.2_

- [x] 6. データファイル更新と最終検証

  - [x] 6.1 全ボンプデータのレア度情報更新

    - 既存の 32 ボンプすべてにレア度情報を追加
    - data/bomps.ts ファイルの完全な再生成
    - 生成されたファイルの構文チェックと型検証
    - _要件: 1.4, 5.1, 5.4_

  - [x] 6.2 データ整合性の最終確認

    - 全ボンプのレア度値が有効な Rarity 型に準拠することを検証
    - 欠損データや無効データの確認
    - 出力ファイルの TypeScript 型安全性確認
    - _要件: 5.4_

  - [x] 6.3 ドキュメントとログの更新
    - レア度フィールド追加について README を更新
    - API 仕様書にレア度抽出パスを記載
    - 処理ログとエラーメッセージの文書化
    - _要件: 5.5_
