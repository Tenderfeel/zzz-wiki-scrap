# 要件定義書

## 概要

この機能は、既存のボンプデータ生成システムを拡張して、各ボンプエンティティにレア度情報を追加します。キャラクターデータと同様に、ボンプにも"A"または"S"のレア度分類を実装し、HoyoLab API から適切にレア度データを抽出・処理して、型安全で一貫性のあるデータ構造を提供します。

## 要件

### 要件 1

**ユーザーストーリー:** 開発者として、ボンプデータにレア度情報を含めたい。そうすることで、キャラクターと同様にボンプもレア度に基づいてフィルタリングや分類ができるようになる。

#### 受入基準

1. WHEN ボンプ型定義を更新する時 THEN Bomp インターフェースに rarity: Rarity フィールドを追加する SHALL
2. WHEN API レスポンスを処理する時 THEN data.page.modules の "component_id": "baseInfo" からレア度情報を抽出する SHALL
3. WHEN レア度データが存在しない時 THEN 適切なデフォルト値またはエラーハンドリングを実装する SHALL
4. WHEN 既存のボンプデータを更新する時 THEN 全 32 のボンプエンティティにレア度情報を追加する SHALL
5. WHEN 型安全性を確保する時 THEN Rarity 型（"A" | "S"）に準拠したデータのみを受け入れる SHALL

### 要件 2

**ユーザーストーリー:** 開発者として、HoyoLab API からボンプのレア度情報を正確に抽出したい。そうすることで、手動でのデータ入力エラーを避け、自動化されたデータ更新が可能になる。

#### 受入基準

1. WHEN API データを解析する時 THEN data.page.modules の baseInfo コンポーネントからレア度値を抽出する SHALL
2. WHEN レア度値を処理する時 THEN "A 級"、"S 級" から "級" を除去して "A"、"S" の英語列挙値にマッピングする SHALL
3. WHEN レア度データが複数の形式で提供される時 THEN 最も信頼性の高いソースを優先して使用する SHALL
4. WHEN API レスポンスにレア度情報が欠損している時 THEN ログに警告を記録し、適切なフォールバック処理を実行する SHALL
5. WHEN レア度抽出が失敗する時 THEN 他のボンプデータの処理を継続し、部分的失敗を許容する SHALL

### 要件 3

**ユーザーストーリー:** 開発者として、既存のボンプデータ処理パイプラインを最小限の変更で拡張したい。そうすることで、現在の機能を破綻させることなく新機能を追加できる。

#### 受入基準

1. WHEN BompDataMapper を更新する時 THEN 既存のマッピング機能を維持しながらレア度抽出機能を追加する SHALL
2. WHEN ProcessedBompData インターフェースを拡張する時 THEN rarity フィールドを BasicBompInfo に追加する SHALL
3. WHEN BompGenerator を更新する時 THEN レア度情報を含む完全なボンプオブジェクトを生成する SHALL
4. WHEN データ検証を実装する時 THEN レア度フィールドの妥当性を確認する検証ロジックを追加する SHALL
5. WHEN 後方互換性を確保する時 THEN 既存のボンプデータ構造との互換性を維持する SHALL

### 要件 4

**ユーザーストーリー:** 開発者として、レア度情報の追加に関する包括的なテストを実装したい。そうすることで、新機能の品質と信頼性を確保できる。

#### 受入基準

1. WHEN 単体テストを作成する時 THEN レア度抽出機能の正確性をテストする SHALL
2. WHEN 統合テストを実装する時 THEN 実際の API データを使用してレア度処理をテストする SHALL
3. WHEN エラーケーステストを作成する時 THEN レア度データ欠損時の処理をテストする SHALL
4. WHEN データ検証テストを実装する時 THEN 無効なレア度値の処理をテストする SHALL
5. WHEN 回帰テストを作成する時 THEN 既存のボンプデータ生成機能が影響を受けないことを確認する SHALL

### 要件 5

**ユーザーストーリー:** 開発者として、レア度情報を含む更新されたボンプデータファイルを生成したい。そうすることで、アプリケーションでレア度に基づくボンプの分類や表示ができるようになる。

#### 受入基準

1. WHEN data/bomps.ts を更新する時 THEN 全ボンプエンティティにレア度フィールドを含める SHALL
2. WHEN TypeScript 型定義を更新する時 THEN Bomp インターフェースにレア度フィールドを追加する SHALL
3. WHEN 出力ファイルを生成する時 THEN 適切な型注釈とインポート文を含める SHALL
4. WHEN データの整合性を確保する時 THEN 全ボンプのレア度値が有効な Rarity 型に準拠することを検証する SHALL
5. WHEN ドキュメントを更新する時 THEN レア度フィールドの追加について適切に文書化する SHALL
