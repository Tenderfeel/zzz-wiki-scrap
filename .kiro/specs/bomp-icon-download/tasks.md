# 実装計画

- [x] 1. 基盤となる型定義とインターフェースの実装

  - BompIcon、BompIconInfo、BompIconDownloadResult、BompIconConfig インターフェースを src/types/processing.ts に追加
  - 既存の型定義との整合性を確保
  - TypeScript の厳格な型安全性を維持
  - _要件: 5.4_

- [x] 2. BompIconProcessor クラスの実装

  - src/processors/BompIconProcessor.ts ファイルを作成
  - HoyoLabApiClient を使用してボンプ API データを取得
  - data.page.icon_url からアイコン URL を抽出する機能を実装
  - _要件: 1.1, 1.2_

- [x] 2.1 アイコンダウンロード機能の実装

  - fetch API を使用してアイコン画像をダウンロード
  - ストリーミングダウンロードでメモリ効率を最適化
  - PNG 形式での保存を実装
  - _要件: 1.1, 2.4_

- [x] 2.2 ファイルパス生成とディレクトリ管理

  - ボンプ ID から安全なファイル名を生成（{bompId}.png 形式）
  - assets/images/bomps/ ディレクトリ構造を作成
  - ディレクトリが存在しない場合の自動作成機能
  - _要件: 2.1, 2.2, 2.5_

- [x] 2.3 エラーハンドリングとリトライ機構

  - 最大 3 回のリトライ機能を実装
  - 指数バックオフによる遅延制御
  - 詳細なエラーログ記録
  - _要件: 3.2, 3.3, 4.5_

- [x] 2.4 ファイル検証機能

  - ダウンロード完了後のファイルサイズ検証
  - 既存ファイルの重複チェック機能
  - ファイル整合性の確認
  - _要件: 3.4, 4.1, 4.2_

- [x] 3. BompIconGenerator クラスの実装

  - src/generators/BompIconGenerator.ts ファイルを作成
  - 既存の BompListParser を使用してボンプエントリを取得
  - 全 32 のボンプアイコンを処理する統合機能
  - _要件: 1.4, 5.5_

- [x] 3.1 バッチ処理と並行制御

  - 3-5 件ずつの並行ダウンロード処理
  - リクエスト間の適切な遅延（500ms）実装
  - メモリ使用量の最適化
  - _要件: 3.1, 3.3_

- [x] 3.2 プログレス追跡と統計情報

  - リアルタイム進捗表示機能
  - 成功・失敗の統計情報収集
  - 処理時間とファイルサイズの記録
  - _要件: 3.5, 4.3, 4.4_

- [x] 4. 設定管理の統合

  - processing-config.json に bompIconDownload セクションを追加
  - デフォルト設定値の定義
  - 設定検証機能の実装
  - _要件: 5.2_

- [x] 5. セキュリティ機能の実装

  - HoyoLab ドメインのみ許可する URL 検証
  - ファイル名のサニタイゼーション
  - ディレクトリトラバーサル攻撃の防止
  - _要件: 2.3_

- [x] 6. メインエントリーポイントの作成

  - src/main-bomp-icon-download.ts ファイルを作成
  - コマンドライン実行可能なスクリプト
  - 既存のプロジェクト構造との統合
  - _要件: 5.1, 5.5_

- [x] 7. エラーハンドリングとログ統合

  - 既存の Logger システムとの統合
  - 既存のエラークラスの使用
  - 詳細なデバッグ情報の出力
  - _要件: 5.3_

- [x] 8. 最終統合とテスト
  - 全コンポーネントの統合テスト
  - エンドツーエンドの動作確認
  - エラーシナリオの検証
  - _要件: 4.4, 4.5_
